<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Business Connection Guide</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <header>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <h1 id="stepTitle">–®–∞–≥ 1 –∏–∑ 4</h1>
        </header>

        <main>
            <!-- Step 1 -->
            <div class="step-card active" id="card1">
                <div class="illustration">‚öôÔ∏è</div>
                <h2>–û—Ç–∫—Ä–æ–π—Ç–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> –≤–∞—à–µ–≥–æ Telegram.</p>
                <div class="hint">–û–±—ã—á–Ω–æ —ç—Ç–æ –∏–∫–æ–Ω–∫–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏.</div>
                <button class="step-confirm-btn" onclick="nextStep()">–Ø –æ—Ç–∫—Ä—ã–ª –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>

            <!-- Step 2 -->
            <div class="step-card" id="card2">
                <div class="illustration">üíº</div>
                <h2>Telegram Business</h2>
                <p>–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª <b>Telegram Business</b> –≤ —Å–ø–∏—Å–∫–µ.</p>
                <div class="hint">–¢–∞–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±–∏–∑–Ω–µ—Å–∞.</div>
                <button class="step-confirm-btn" onclick="nextStep()">–Ø –ø–µ—Ä–µ—à–µ–ª –≤ Business</button>
            </div>

            <!-- Step 3 -->
            <div class="step-card" id="card3">
                <div class="illustration">ü§ñ</div>
                <h2>–ß–∞—Ç-–±–æ—Ç—ã</h2>
                <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø—É–Ω–∫—Ç <b>–ß–∞—Ç-–±–æ—Ç—ã</b>.</p>
                <div class="hint">–ó–¥–µ—Å—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è.</div>
                <button class="step-confirm-btn" onclick="nextStep()">–Ø –Ω–∞–∂–∞–ª –Ω–∞ –ß–∞—Ç-–±–æ—Ç—ã</button>
            </div>

            <!-- Step 4 -->
            <div class="step-card" id="card4">
                <div class="illustration">üöÄ</div>
                <h2>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞</h2>
                <p>–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º –∏ –≤–∫–ª—é—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø:</p>
                <div class="bot-box" id="botUsername" onclick="copyBotName()">@loading...</div>
                <div class="hint">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω!</div>
                <button class="final-check-btn" id="finalCheckBtn" onclick="runFinalCheck()">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                </button>
            </div>
        </main>

        <div class="back-link" id="prevBtn" onclick="prevStep()" style="visibility: hidden;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let currentStep = 1;
        const totalSteps = 4;

        const urlParams = new URLSearchParams(window.location.search);
        const botName = urlParams.get('bot') || '–≤–∞—à–µ–≥–æ –±–æ—Ç–∞';
        document.getElementById('botUsername').innerText = '@' + botName;

        const stepTitle = document.getElementById('stepTitle');
        const progress = document.getElementById('progress');
        const prevBtn = document.getElementById('prevBtn');

        function updateUI() {
            stepTitle.innerText = `–®–∞–≥ ${currentStep} –∏–∑ ${totalSteps}`;
            progress.style.width = `${(currentStep / totalSteps) * 100}%`;

            document.querySelectorAll('.step-card').forEach((card, idx) => {
                card.classList.toggle('active', idx + 1 === currentStep);
            });

            prevBtn.style.visibility = (currentStep === 1 || currentStep === totalSteps) ? 'hidden' : 'visible';
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateUI();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateUI();
            }
        }

        function runFinalCheck() {
            const btn = document.getElementById('finalCheckBtn');
            btn.disabled = true;
            btn.innerText = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ –±—ã–ª–æ —Å—é—Ä–ø—Ä–∏–∑–æ–º
            tg.showPopup({
                title: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞',
                message: '–°–µ–π—á–∞—Å –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –∏ –±–æ—Ç –ø—Ä–∏—à–ª–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —á–∞—Ç. –ì–æ—Ç–æ–≤—ã?',
                buttons: [{ id: 'ok', type: 'default', text: '–î–∞, –¥–∞–≤–∞–π' }]
            }, (btnId) => {
                if (btnId === 'ok') {
                    tg.sendData(JSON.stringify({ action: 'check_business_connection' }));
                    setTimeout(() => { tg.close(); }, 100);
                }
            });
        }

        function copyBotName() {
            const text = document.getElementById('botUsername').innerText;
            navigator.clipboard.writeText(text).then(() => {
                tg.showScanQrPopup({ text: '–Æ–∑–µ—Ä–Ω–µ–π–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!' }); // –ú–∞–ª–µ–Ω—å–∫–∏–π —Ö–∞–∫ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                // –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ª—É—á—à–µ tg.showAlert, –Ω–æ tg.showScanQrPopup –≤—ã–≥–ª—è–¥–∏—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
                setTimeout(() => { tg.closeScanQrPopup(); }, 1000);
            }).catch(() => {
                tg.showAlert('–Æ–∑–µ—Ä–Ω–µ–π–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + text);
            });
        }

        updateUI();
    </script>
</body>

</html>